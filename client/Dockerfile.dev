# Development Dockerfile for Next.js Frontend
FROM node:20-alpine

WORKDIR /app

# Accept build arguments for user/group IDs (defaults to 1000 if not provided)
ARG HOST_UID=1000
ARG HOST_GID=1000

# Install dependencies
RUN apk add --no-cache git libc6-compat

# Copy package files
COPY package*.json ./

# Install dependencies
RUN npm ci

# Copy source code (use numeric UID/GID to avoid user lookup issues)
COPY --chown=${HOST_UID}:${HOST_GID} . .

# Note: In development, we run as the node user (UID 1000) which matches most host systems
# The node image already has a 'node' user with UID 1000
# If your host UID differs, you may need to adjust permissions manually

# Expose port
EXPOSE 3000

# Set environment for development
ENV NODE_ENV=development
ENV NEXT_TELEMETRY_DISABLED=1

# Start development server with host binding for Docker
CMD ["npm", "run", "dev", "--", "-H", "0.0.0.0"]

