# Click-to-Place Signature Feature

## ğŸ¯ Overview

Users can now **click the Sign tool and place signatures anywhere** on the PDF document, not just in pre-defined fields. This works like using a rubber stamp - select your signature and click anywhere on the document to place it.

---

## ğŸš€ How It Works

### **Step-by-Step Workflow**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. Click "âœï¸ Sign" tool in left sidebar             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  2. Right sidebar opens with saved signatures        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  3. Click a signature to select it                   â”‚
â”‚     â†’ Signature now follows your cursor              â”‚
â”‚     â†’ Cursor changes to crosshair                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  4. Click anywhere on the PDF                        â”‚
â”‚     â†’ Signature placed at that location              â”‚
â”‚     â†’ Saved to backend                               â”‚
â”‚     â†’ Appears immediately on document                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“º Visual Guide

### **1. Activate Sign Tool**
```
Left Sidebar:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  T  â”‚ âœï¸  â”‚ âŒ«  â”‚
â”‚  â—»  â”‚ ğŸ–¼  â”‚ ğŸ”— â”‚
â”‚ [âœï¸] â”‚ â¹  â”‚ âœ‚  â”‚  â† Click this
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **2. Right Sidebar Opens**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Signature List                   â”‚
â”‚  Select a signature, then         â”‚
â”‚  click on PDF                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [+ New Signature]               â”‚
â”‚                                   â”‚
â”‚  Saved Signatures (2)            â”‚
â”‚                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ John Doe             [ğŸ—‘] â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚ â”‚  John Doe        â”‚     â”‚   â”‚ â† Click to select
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **3. Signature Selected - Cursor Preview**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Signature List                         â”‚
â”‚  âœ“ Click on PDF to place signature     â”‚
â”‚  ğŸ–±ï¸ Click anywhere on the PDF to place â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Saved Signatures (2)                  â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ John Doe [selected] âœ“       [ğŸ—‘] â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PDF Viewer:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                       â”‚
â”‚  [Moving preview of signature         â”‚
â”‚   follows your cursor]                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚   â”‚ John Doe    â”‚ â† Follows mouse     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                       â”‚
â”‚  Cursor: âœš (crosshair)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **4. Click to Place**
```
PDF Viewer:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Patient Information                  â”‚
â”‚  Name: _______________                â”‚
â”‚  Date: _______________                â”‚
â”‚                                       â”‚
â”‚  I hereby consent to...               â”‚
â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚   John Doe          â”‚ â† Placed!   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                       â”‚
â”‚  Date: ______________                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¨ Visual Feedback

### **Cursor States**

| State | Cursor | Description |
|-------|--------|-------------|
| Normal | `â†’` | Default cursor |
| Sign tool active (no signature) | `â†’` | Regular cursor + hint overlay |
| Signature selected | `âœš` | Crosshair + moving preview |

### **Signature Preview**

When signature is selected:
- **Dashed blue border** around preview
- **Semi-transparent** (70% opacity)
- **Follows cursor** exactly
- **200x60px** size (default)

### **Placed Signatures**

After placement:
- **Solid green border**
- **Light green background**
- **Full opacity**
- **Permanent** (saved to backend)

---

## ğŸ†š Two Ways to Sign

### **Method 1: Pre-defined Fields** (Original)
```
Use Case: Consent forms with specific signature areas
         (Patient signature, Doctor signature, etc.)

Process:
1. PDF loads with colored signature fields
2. Click on a field
3. Select/create signature
4. Signature fills that specific field
```

### **Method 2: Click-to-Place** (New!)
```
Use Case: Annotating documents, initialing pages,
         signing arbitrary locations

Process:
1. Click Sign tool in sidebar
2. Select a saved signature
3. Click anywhere on PDF
4. Signature placed at that exact spot
```

**Both methods work together!** You can use fields AND free placement in the same document.

---

## ğŸ”§ Technical Details

### **Placement Calculation**

```typescript
// User clicks at (clientX, clientY)
const container = e.currentTarget.getBoundingClientRect();

// Calculate position relative to PDF
const clickX = e.clientX - rect.left;
const clickY = e.clientY - rect.top;

// Account for zoom and centering
const pdfWidth = 595 * zoom;
const offsetX = (containerWidth - pdfWidth) / 2;

// Get position in PDF coordinates
const x = (clickX - offsetX) / zoom;
const y = (clickY - offsetY) / zoom;
```

### **API Call**

```typescript
POST /api/v1/consents/{consentId}/annotations
{
  "type": "SIGNATURE",
  "content": {
    "signatureName": "John Doe",
    "signatureData": "data:image/png;base64,...",
    "signatureType": "draw"
  },
  "pageNumber": 3,
  "xPosition": 150,
  "yPosition": 400,
  "width": 200,
  "height": 60
}
```

### **State Management**

```typescript
// Selected signature for placement
const [selectedSignatureToPlace, setSelectedSignatureToPlace] = 
  useState<SavedSignature | null>(null);

// Array of placed signatures (per page)
const [placedSignatures, setPlacedSignatures] = useState<Array<{
  id: string;
  signature: SavedSignature;
  pageNumber: number;
  x: number;
  y: number;
  width: number;
  height: number;
}>>([]);

// Cursor position for preview
const [cursorPosition, setCursorPosition] = 
  useState<{ x: number; y: number } | null>(null);
```

---

## ğŸ“‹ Use Cases

### **1. Patient Initials on Each Page**
```
Page 1: [JD] â† Initial bottom right
Page 2: [JD] â† Initial bottom right
Page 3: [JD] â† Initial bottom right
```

### **2. Multiple Approvals**
```
Consent Form:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Procedure: Rhinoplasty          â”‚
â”‚                                   â”‚
â”‚  Approved by:                     â”‚
â”‚  Surgeon: [Dr. Smith signature]  â”‚
â”‚  Nurse:   [Nurse A signature]    â”‚
â”‚  Admin:   [Admin B signature]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **3. Corrections & Annotations**
```
Original Text: The patient will pay $5,000
                                   ^
                            [initials]
                         (correction approved)
```

### **4. Witness Signatures**
```
Main signature field: [Patient signature]

Witnessed by: [Witness 1] â† Click-to-place
             [Witness 2] â† Click-to-place
```

---

## ğŸ¯ Key Features

| Feature | Status | Description |
|---------|--------|-------------|
| **Cursor Preview** | âœ… | Signature follows cursor |
| **Crosshair Cursor** | âœ… | Visual feedback |
| **Multi-page** | âœ… | Place on any page |
| **Zoom Support** | âœ… | Works at any zoom level |
| **Backend Save** | âœ… | Persists to database |
| **Real-time Display** | âœ… | Shows immediately |
| **Multiple Placements** | âœ… | Same signature multiple times |
| **Undo** | â³ | Coming soon |

---

## ğŸš¨ Important Notes

### **Bounds Checking**
Signatures must be placed **within PDF bounds**. Click outside â†’ ignored.

```typescript
// Check if click is within PDF bounds
if (x < 0 || x > 595 - signatureWidth || 
    y < 0 || y > 842 - signatureHeight) {
  console.log('Click outside PDF bounds');
  return;
}
```

### **Z-Index Layering**
```
Bottom â†’ Top:
1. PDF Document (iframe)
2. Pre-defined signature fields
3. Placed signatures
4. Cursor preview
5. Tool hints
```

### **Pointer Events**
- PDF iframe: `pointer-events: none` (clicks pass through)
- Placed signatures: `pointer-events: none` (can't interfere)
- Container: Captures all clicks

---

## ğŸ¬ Complete Example

```typescript
// 1. User clicks Sign tool
setSelectedTool('sign');
setShowSignatureList(true);

// 2. User selects signature
handleSelectSignatureForPlacement(signature);
// â†’ selectedSignatureToPlace = signature
// â†’ cursor changes to crosshair
// â†’ preview follows cursor

// 3. User clicks on PDF at (x: 150, y: 400)
handlePdfClick(event);
// â†’ Calculate position
// â†’ POST to /api/v1/consents/{id}/annotations
// â†’ Add to placedSignatures array
// â†’ Signature appears on PDF

// 4. Result
// Signature visible at exact position
// Saved to backend
// Can repeat for more signatures
```

---

## ğŸ’¡ Pro Tips

1. **Multiple Initials**: Select signature once, click multiple times
2. **Different Pages**: Change page, signature stays selected
3. **Quick Reset**: Click Sign tool again to deselect
4. **Precise Placement**: Zoom in for pixel-perfect positioning
5. **Saved Forever**: All placements saved to backend

---

## ğŸ”„ Workflow Comparison

### **Before (Field-only)**
```
âŒ Can only sign in pre-defined fields
âŒ Limited to specific locations
âŒ No flexibility for annotations
```

### **After (Field + Click-to-Place)**
```
âœ… Sign in pre-defined fields
âœ… Place signatures anywhere
âœ… Multiple signatures per page
âœ… Flexible document annotation
âœ… Just like physical documents!
```

---

## ğŸ‰ Result

You now have **two powerful ways** to sign documents:

1. **Structured**: Use pre-defined fields (patient/doctor/witness)
2. **Flexible**: Click anywhere to place signatures/initials

**This matches real-world consent signing workflows perfectly!** ğŸ–Šï¸âœ¨



