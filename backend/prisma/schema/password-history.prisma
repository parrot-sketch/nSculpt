// Password History: Track password changes to prevent reuse
// Part of Phase 2 User Management security enhancements

model PasswordHistory {
  id            String   @id @default(uuid()) @db.Uuid
  userId        String   @db.Uuid
  passwordHash  String   @db.VarChar(255) // Bcrypt hash
  changedAt     DateTime @default(now()) @db.Timestamptz(6)
  changedBy     String?  @db.Uuid // Who changed the password (admin or self)
  ipAddress     String?  @db.VarChar(45) // IPv4 or IPv6
  userAgent     String?  @db.Text
  reason        String?  @db.Text // "User changed password", "Admin reset", etc.

  // Relations
  user User @relation("UserPasswordHistory", fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, changedAt]) // For quick lookups of user's password history
  @@map("password_history")
}
